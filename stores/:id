<div id="store_container">
    <script id="store_template" type="x-tmpl-mustache/text">
        <div class="main_banner text-center">
            <h2>{{name}}</h2>
            <p data-i18n="inside_page.header_tagline"></p>
        </div>
        <div class="main_container content_container">
            <div class="store_list_head">
                <div class="row">
                    <div class="col-md-12 store_top">
                        <h5 class="back_btn show_phone"><i class="fa fa-angle-left" aria-hidden="true"></i> <a href="/stores" class="store_anchors active_heading"><span data-i18n="stores.back_btn"></span></a></h5>
                        <span class="soft_hidden_phone store_anchors active_heading"><i class="fa fa-angle-left" aria-hidden="true"></i> <a href="/stores"><span data-i18n="stores.back_btn"></span></a></span>
                        <div class="store_details_anchors pull-right">
                            <a id="promo_anchor" href="#promos_main" class="store_anchors active_heading">
                                <span data-i18n="stores.store_promo"></span> (<span></span>)
                            </a>
                            <a id="job_anchor" href="#jobs_main" class="store_anchors active_heading">
                                <span data-i18n="stores.store_job"></span> (<span></span>)
                            </a>
                        </div>
                    </div>
                </div>
            </div>
            <div class="margin_25_across">
                <div class="row">
                    <div class="col-md-8">
                        <div class="details_desc">
                            <img class="margin_20 img-responsive" style="{{show_store_front}}" src="{{store_front_alt_url_abs}}" alt="{{name}} Store Front" />
                            <div class="margin_20 primary-locale">{{{rich_description}}}</div>
                            <div class="margin_20 secondary-locale">{{{rich_description_2}}}</div>
                            <div class="map hidden_now">
                        	    <div class="zoom_container" id="zoom_container_store">
                            		<img id="zoom_image" src=""/>
                            		<div class="landmarks" data-show-at-zoom="0" data-allow-drag="true"></div>
                            	</div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <img class="margin_20 store_logo center-block" src="{{store_front_url_abs}}"/>
                        <div class="side_stores">
                            <a class="animated_btn newsletter_btn" href="tel:{{phone}}" style="{{phone_show}}">
                                <span data-i18n="stores.store_phone"></span>: {{phone}}
                            </a>
                            <a class="animated_btn newsletter_btn" href="//{{website}}" target="_blank" style="{{show}}">
                                <span data-i18n="stores.store_website"></span>
                            </a>
                        </div>
                    </div> 
                </div>
            </div>
        </div>
    </script>
</div>
<div class="main_container content_container">
    <div class="margin_25_across">
        <div class="row">
            <div class="col-md-8 promo_item" id="promos_main">
                <h2 class="store_details_promo_heading">
                    <span data-i18n="stores.store_promo"></span>
                </h2>
                <div id="promos_container">
                    <script id="promos_template" type="x-tmpl-mustache/text">
                        <div class="row promo_item">
                            <div class="primary-locale">
                                <div class="col-sm-4">
                                    <img class="promo_store_image" src="{{promo_image_url_abs}}" alt="{{name}}" />
                                </div>
                                <div class="col-sm-8">
                                    <h2 class="promo_list_name">{{name}}</h2>
                                    <p>
                                        <span class="promo_dates">{{dates}}</span>
                                    </p>
                                    <div class="promo_list_desc">{{description_short}}</div>
                                    <a class="read_more" href="/promotions/{{slug}}">See Promotion Details <i class="fa fa-angle-right"></i></a>
                                </div>
                            </div>
                            <div class="secondary-locale">
                                <div class="col-md-5">
                                    <img class="promo_store_image" src="{{image_url}}" alt="{{name_2}}" />
                                </div>
                                <div class="col-md-7">
                                    <h2 class="promo_list_name">{{name_2}}</h2>
                                    <p>
                                        <span class="promo_dates">{{dates}}</span>
                                    </p>
                                    <div class="promo_list_desc">{{description_short_2}}</div>
                                    <a class="read_more" href="/promotions/{{slug}}">Voir les d√©tails de la promotion <i class="fa fa-angle-right"></i></a>
                                </div>
                            </div>
                        </div>
                    </script>
                </div>
            </div>
            <div class="col-md-8 promo_item" id="jobs_main">
                <h2 class="store_details_promo_heading">
                    <span data-i18n="stores.store_jobs"></span>
                </h2>
                <div id="jobs_container">
                    <script id="jobs_template" type="x-tmpl-mustache/text">
                        <div class="row promo_item" data-cat="{{cat_list}}">
                            <div class="col-md-12">
                                <h2 class="promo_list_name">{{name}}</h2>
                                <p>
                                    <span class="promo_dates">{{job_type}}</span>
                                </p>
                                <div class="promo_list_desc">{{description_short}}</div>
                                <a class="read_more" href="/jobs/{{slug}}">Read More</a>
                            </div>
                        </div>
                    </script>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="//codecloud.cdn.speedyrails.net/sites/59035a6c6e6f645a5b420000/application/x-javascript/1503602727000/smoothZoomA24.js"></script>
<script>
    $(document).ready(function(e){
        init(e);
        function renderAll (){
            var pathArray = window.location.pathname.split( '/' );
            var slug = pathArray[pathArray.length-1];
            var store_details = getStoreDetailsBySlug(slug);
            renderStoreDetails("#store_container","#store_template", store_details, slug);
            
            var banner_repo = getRepoDetailsByName("Directory Banner").images;
            if (banner_repo) {
                var banner_image = banner_repo[0].image_url;
                if (banner_image) {
                    $(".main_banner").css({ "backgroundImage": "url(" + banner_image + ")" });
                }
            }
            
            //PROMOS
            var store_promo_ids = store_details.promotions
            var store_promos = getPromotionsForIds(store_promo_ids).sortBy(function(o){ return o.start_date });
            var published_promos = [];
            $.each( store_promos , function( key, val ){
                today = moment();
                webDate = moment(val.show_on_web_date);
                if (today >= webDate) {
                    published_promos.push(val)
                } 
            });
            if( published_promos.length > 0){
                renderPromotions("#promos_container","#promos_template", published_promos);
                $('#promo_anchor span').text(published_promos.length)
            } else {
                $('#promos_main').hide()
                $('#promo_anchor').hide()
            }
            
            // JOBS
            var store_job_ids = store_details.jobs
            var store_jobs = getJobsForIds(store_job_ids).sortBy(function(o){ return o.start_date });
            var published_jobs = [];
            $.each( store_jobs , function( key, val ){
                today = moment();
                webDate = moment(val.show_on_web_date);
                if (today >= webDate) {
                    published_jobs.push(val)
                } 
            });
            if( published_jobs.length > 0){
                renderJobs('#jobs_container', '#jobs_template', published_jobs);
                $('#job_anchor span').text(published_jobs.length)
            } else {
                $('#jobs_main').hide();
                $('#job_anchor').hide()
            }
            
            show_content();
            
            //MAP  
            if (store_details.x_coordinate != null && store_details.y_coordinate != null) {
                $("#zoom_image").attr("src", getPNGMapURL());
        		$('#zoom_image').smoothZoom({
        		    width: "100%",
                    height: 465,
        		    initial_ZOOM: 0,
        			zoom_MIN: 0,
        			zoom_MAX: 250,
        			responsive: true,
        		    responsive_maintain_ratio: true,
        			zoom_BUTTONS_SHOW : 'YES',
        			pan_BUTTONS_SHOW : 'NO',
        			pan_LIMIT_BOUNDARY : 'NO',
        			button_SIZE: 24,
        			button_ALIGN: "top right",
        			zoom_OUT_TO_FIT: "NO",
        			container: 'zoom_container_store'
        		});
        		var store_x_coordinate = store_details.x_coordinate;
        		var store_y_coordinate = store_details.y_coordinate;
        		var pin_id = store_details.id; 
        		var store_name = store_details.name;
    		    add_landmark(store_x_coordinate, store_y_coordinate, pin_id, store_name);
    		    $(".map").show();
    		}
        }
		
		loadMallDataCached(renderAll); 
    });
</script>